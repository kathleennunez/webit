<?php include __DIR__ . '/../components/header.php'; ?>
<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h4 fw-bold">Create a webinar</h1>
      <p class="text-muted">Publish a new session for the community.</p>
    </div>
    <a class="btn btn-outline-primary" href="/app/dashboard.php"><i class="bi bi-arrow-left me-2"></i>Back</a>
  </div>

  <?php if ($message): ?>
    <div class="alert alert-success"><?php echo sanitize($message); ?></div>
  <?php endif; ?>
  <?php if ($error): ?>
    <div class="alert alert-danger"><?php echo sanitize($error); ?></div>
  <?php endif; ?>

  <div class="glass-panel p-4">
    <div class="d-flex justify-content-end mb-3">
      <a class="btn btn-outline-primary btn-sm" href="/app/drafts.php">View drafts</a>
    </div>
    <form method="post" enctype="multipart/form-data">
      <input type="hidden" name="create_webinar" value="1">
      <?php if ($editing && !empty($_GET['edit'])): ?>
        <input type="hidden" name="webinar_id" value="<?php echo sanitize($_GET['edit']); ?>">
      <?php endif; ?>
      <div class="mb-3">
        <label class="form-label">Title</label>
        <input class="form-control" name="title" value="<?php echo sanitize($formData['title']); ?>" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Description</label>
        <textarea class="form-control" name="description" rows="3"><?php echo sanitize($formData['description']); ?></textarea>
      </div>
      <div class="mb-3">
        <label class="form-label">Date</label>
        <input class="form-control" type="date" name="date" value="<?php echo sanitize($formData['date']); ?>" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Time</label>
        <div class="row g-2">
          <div class="col-md-6">
            <div class="time-picker" data-time-picker>
              <input class="form-control" type="text" value="<?php echo sanitize($formData['start_time']); ?>" placeholder="Start time" data-time-input>
              <input type="hidden" name="start_time" value="<?php echo sanitize($formData['start_time']); ?>" data-time-value>
              <div class="time-menu" data-time-menu>
                <button type="button" class="time-item" data-time-item="00:00">12:00 AM</button>
                <button type="button" class="time-item" data-time-item="00:30">12:30 AM</button>
                <button type="button" class="time-item" data-time-item="01:00">01:00 AM</button>
                <button type="button" class="time-item" data-time-item="01:30">01:30 AM</button>
                <button type="button" class="time-item" data-time-item="02:00">02:00 AM</button>
                <button type="button" class="time-item" data-time-item="02:30">02:30 AM</button>
                <button type="button" class="time-item" data-time-item="03:00">03:00 AM</button>
                <button type="button" class="time-item" data-time-item="03:30">03:30 AM</button>
                <button type="button" class="time-item" data-time-item="04:00">04:00 AM</button>
                <button type="button" class="time-item" data-time-item="04:30">04:30 AM</button>
                <button type="button" class="time-item" data-time-item="05:00">05:00 AM</button>
                <button type="button" class="time-item" data-time-item="05:30">05:30 AM</button>
                <button type="button" class="time-item" data-time-item="06:00">06:00 AM</button>
                <button type="button" class="time-item" data-time-item="06:30">06:30 AM</button>
                <button type="button" class="time-item" data-time-item="07:00">07:00 AM</button>
                <button type="button" class="time-item" data-time-item="07:30">07:30 AM</button>
                <button type="button" class="time-item" data-time-item="08:00">08:00 AM</button>
                <button type="button" class="time-item" data-time-item="08:30">08:30 AM</button>
                <button type="button" class="time-item" data-time-item="09:00">09:00 AM</button>
                <button type="button" class="time-item" data-time-item="09:30">09:30 AM</button>
                <button type="button" class="time-item" data-time-item="10:00">10:00 AM</button>
                <button type="button" class="time-item" data-time-item="10:30">10:30 AM</button>
                <button type="button" class="time-item" data-time-item="11:00">11:00 AM</button>
                <button type="button" class="time-item" data-time-item="11:30">11:30 AM</button>
                <button type="button" class="time-item" data-time-item="12:00">12:00 PM</button>
                <button type="button" class="time-item" data-time-item="12:30">12:30 PM</button>
                <button type="button" class="time-item" data-time-item="13:00">01:00 PM</button>
                <button type="button" class="time-item" data-time-item="13:30">01:30 PM</button>
                <button type="button" class="time-item" data-time-item="14:00">02:00 PM</button>
                <button type="button" class="time-item" data-time-item="14:30">02:30 PM</button>
                <button type="button" class="time-item" data-time-item="15:00">03:00 PM</button>
                <button type="button" class="time-item" data-time-item="15:30">03:30 PM</button>
                <button type="button" class="time-item" data-time-item="16:00">04:00 PM</button>
                <button type="button" class="time-item" data-time-item="16:30">04:30 PM</button>
                <button type="button" class="time-item" data-time-item="17:00">05:00 PM</button>
                <button type="button" class="time-item" data-time-item="17:30">05:30 PM</button>
                <button type="button" class="time-item" data-time-item="18:00">06:00 PM</button>
                <button type="button" class="time-item" data-time-item="18:30">06:30 PM</button>
                <button type="button" class="time-item" data-time-item="19:00">07:00 PM</button>
                <button type="button" class="time-item" data-time-item="19:30">07:30 PM</button>
                <button type="button" class="time-item" data-time-item="20:00">08:00 PM</button>
                <button type="button" class="time-item" data-time-item="20:30">08:30 PM</button>
                <button type="button" class="time-item" data-time-item="21:00">09:00 PM</button>
                <button type="button" class="time-item" data-time-item="21:30">09:30 PM</button>
                <button type="button" class="time-item" data-time-item="22:00">10:00 PM</button>
                <button type="button" class="time-item" data-time-item="22:30">10:30 PM</button>
                <button type="button" class="time-item" data-time-item="23:00">11:00 PM</button>
                <button type="button" class="time-item" data-time-item="23:30">11:30 PM</button>
              </div>
            </div>
            <div class="form-text">Start time</div>
          </div>
          <div class="col-md-6">
            <div class="time-picker" data-time-picker>
              <input class="form-control" type="text" value="<?php echo sanitize($formData['end_time']); ?>" placeholder="End time" data-time-input>
              <input type="hidden" name="end_time" value="<?php echo sanitize($formData['end_time']); ?>" data-time-value>
              <div class="time-menu" data-time-menu>
                <button type="button" class="time-item" data-time-item="00:00">12:00 AM</button>
                <button type="button" class="time-item" data-time-item="00:30">12:30 AM</button>
                <button type="button" class="time-item" data-time-item="01:00">01:00 AM</button>
                <button type="button" class="time-item" data-time-item="01:30">01:30 AM</button>
                <button type="button" class="time-item" data-time-item="02:00">02:00 AM</button>
                <button type="button" class="time-item" data-time-item="02:30">02:30 AM</button>
                <button type="button" class="time-item" data-time-item="03:00">03:00 AM</button>
                <button type="button" class="time-item" data-time-item="03:30">03:30 AM</button>
                <button type="button" class="time-item" data-time-item="04:00">04:00 AM</button>
                <button type="button" class="time-item" data-time-item="04:30">04:30 AM</button>
                <button type="button" class="time-item" data-time-item="05:00">05:00 AM</button>
                <button type="button" class="time-item" data-time-item="05:30">05:30 AM</button>
                <button type="button" class="time-item" data-time-item="06:00">06:00 AM</button>
                <button type="button" class="time-item" data-time-item="06:30">06:30 AM</button>
                <button type="button" class="time-item" data-time-item="07:00">07:00 AM</button>
                <button type="button" class="time-item" data-time-item="07:30">07:30 AM</button>
                <button type="button" class="time-item" data-time-item="08:00">08:00 AM</button>
                <button type="button" class="time-item" data-time-item="08:30">08:30 AM</button>
                <button type="button" class="time-item" data-time-item="09:00">09:00 AM</button>
                <button type="button" class="time-item" data-time-item="09:30">09:30 AM</button>
                <button type="button" class="time-item" data-time-item="10:00">10:00 AM</button>
                <button type="button" class="time-item" data-time-item="10:30">10:30 AM</button>
                <button type="button" class="time-item" data-time-item="11:00">11:00 AM</button>
                <button type="button" class="time-item" data-time-item="11:30">11:30 AM</button>
                <button type="button" class="time-item" data-time-item="12:00">12:00 PM</button>
                <button type="button" class="time-item" data-time-item="12:30">12:30 PM</button>
                <button type="button" class="time-item" data-time-item="13:00">01:00 PM</button>
                <button type="button" class="time-item" data-time-item="13:30">01:30 PM</button>
                <button type="button" class="time-item" data-time-item="14:00">02:00 PM</button>
                <button type="button" class="time-item" data-time-item="14:30">02:30 PM</button>
                <button type="button" class="time-item" data-time-item="15:00">03:00 PM</button>
                <button type="button" class="time-item" data-time-item="15:30">03:30 PM</button>
                <button type="button" class="time-item" data-time-item="16:00">04:00 PM</button>
                <button type="button" class="time-item" data-time-item="16:30">04:30 PM</button>
                <button type="button" class="time-item" data-time-item="17:00">05:00 PM</button>
                <button type="button" class="time-item" data-time-item="17:30">05:30 PM</button>
                <button type="button" class="time-item" data-time-item="18:00">06:00 PM</button>
                <button type="button" class="time-item" data-time-item="18:30">06:30 PM</button>
                <button type="button" class="time-item" data-time-item="19:00">07:00 PM</button>
                <button type="button" class="time-item" data-time-item="19:30">07:30 PM</button>
                <button type="button" class="time-item" data-time-item="20:00">08:00 PM</button>
                <button type="button" class="time-item" data-time-item="20:30">08:30 PM</button>
                <button type="button" class="time-item" data-time-item="21:00">09:00 PM</button>
                <button type="button" class="time-item" data-time-item="21:30">09:30 PM</button>
                <button type="button" class="time-item" data-time-item="22:00">10:00 PM</button>
                <button type="button" class="time-item" data-time-item="22:30">10:30 PM</button>
                <button type="button" class="time-item" data-time-item="23:00">11:00 PM</button>
                <button type="button" class="time-item" data-time-item="23:30">11:30 PM</button>
              </div>
            </div>
            <div class="form-text">End time</div>
          </div>
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label">Category</label>
        <select class="form-select" name="category">
          <option <?php echo $formData['category'] === 'Education' ? 'selected' : ''; ?>>Education</option>
          <option <?php echo $formData['category'] === 'Business' ? 'selected' : ''; ?>>Business</option>
          <option <?php echo $formData['category'] === 'Wellness' ? 'selected' : ''; ?>>Wellness</option>
          <option <?php echo $formData['category'] === 'Technology' ? 'selected' : ''; ?>>Technology</option>
          <option <?php echo $formData['category'] === 'Growth' ? 'selected' : ''; ?>>Growth</option>
          <option <?php echo $formData['category'] === 'Marketing' ? 'selected' : ''; ?>>Marketing</option>
          <option <?php echo $formData['category'] === 'Design' ? 'selected' : ''; ?>>Design</option>
          <option <?php echo $formData['category'] === 'Leadership' ? 'selected' : ''; ?>>Leadership</option>
          <option <?php echo $formData['category'] === 'Finance' ? 'selected' : ''; ?>>Finance</option>
          <option <?php echo $formData['category'] === 'Health' ? 'selected' : ''; ?>>Health</option>
          <option <?php echo $formData['category'] === 'Productivity' ? 'selected' : ''; ?>>Productivity</option>
          <option <?php echo $formData['category'] === 'Creative' ? 'selected' : ''; ?>>Creative</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="form-label">Instructor</label>
        <input class="form-control" name="instructor" value="<?php echo sanitize($formData['instructor']); ?>">
      </div>
      <div class="mb-3">
        <label class="form-label">Preview image</label>
        <input class="form-control" type="file" name="image" accept="image/*" data-image-input>
      </div>
      <div class="mb-3">
        <label class="form-label">Meeting URL</label>
        <input class="form-control" name="meeting_url" value="<?php echo sanitize($formData['meeting_url']); ?>" placeholder="https://zoom.us/j/..." required>
      </div>
      <div class="mb-3">
        <label class="form-label">Capacity</label>
        <input class="form-control" type="number" min="0" name="capacity" value="<?php echo sanitize((string)$formData['capacity']); ?>" placeholder="0">
        <div class="form-text">Set to 0 for unlimited seats.</div>
      </div>
      <div class="border rounded-4 p-3 mb-3">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="premium" value="1" id="premiumCheck" data-premium-toggle <?php echo $formData['premium'] ? 'checked' : ''; ?> <?php echo $hasSubscription ? '' : 'disabled'; ?>>
          <label class="form-check-label fw-semibold" for="premiumCheck">Premium webinar</label>
        </div>
        <?php if (!$hasSubscription): ?>
          <div class="text-muted small mt-2">Premium webinars require an active subscription. <a href="/app/subscription.php" class="text-decoration-none">View plans</a>.</div>
        <?php endif; ?>
        <div class="mt-3 <?php echo $formData['premium'] && $hasSubscription ? '' : 'd-none'; ?>" data-premium-price>
          <label class="form-label">Price (USD)</label>
          <input class="form-control" type="number" step="0.01" min="0" name="price" value="<?php echo sanitize((string)$formData['price']); ?>" placeholder="0.00">
        </div>
      </div>
      <div class="mb-3">
        <img src="<?php echo sanitize($formData['image']); ?>" class="w-100 rounded-4" alt="Preview" data-image-preview>
      </div>
      <div class="d-grid gap-2">
        <button class="btn btn-primary" name="publish" value="1">Publish</button>
        <button class="btn btn-outline-primary" name="save_draft" value="1">Save as draft</button>
      </div>
    </form>
  </div>
</div>
<?php include __DIR__ . '/../components/footer.php'; ?>
